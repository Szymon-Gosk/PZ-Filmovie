{% extends 'base.html' %}
{% load static %}

{% block css %}
<link href="{% static 'css/styles-profile.css' %}" type="text/css" rel="stylesheet" media="screen,projection"/>
{% endblock %}
 

{% block content %}


  <main id="container">
    {% if profile.background %}
    <section id="photo-content" style="background-image: url('{{profile.background.url}}'); width: 100%; height: 45vh; background-repeat: no-repeat; background-size: cover; display: flex; justify-content:center; align-items: flex-end;">
      <div id="profile-pic">

        {% if profile.picture %}
        <img src="{{profile.picture.url}}">
        {% else %}
        <img src="{% static 'img/woman.png' %}">
        {% endif %}
      </div>
    </section>
    {% else %}
    <section id="photo-content" style="background-image: url('../../static/img/top-profile.png'); width: 100%; height: 45vh; background-repeat: no-repeat; background-size: cover; display: flex; justify-content:center; align-items: flex-end;">
      <div id="profile-pic">

        {% if profile.picture %}
        <img src="{{profile.picture.url}}">
        {% else %}
        <img src="{% static 'img/woman.png' %}">
        {% endif %}
      </div>
    </section>
    {% endif %}
    <section class="text-content">
      <span class="profile-text name s-border">{{profile.first_name}}&nbsp{{profile.last_name}}</span>
      <span class="profile-text s-border">
        <i class="material-icons" aria-hidden="true">edit</i>
        {{profile.bio}}
      </span>
      <span class="profile-text s-border">
        <a href="{% url 'followers' profile.user.username %}"><i class="material-icons" aria-hidden="true">visibility</i></a>
        followers {{profile.followers.count}}
      </span>
      <span class="profile-text s-border">
        <a href="{% url 'following' profile.user.username %}"><i class="material-icons" aria-hidden="true">visibility</i></a>
        following {{following}}
      </span>

      {% if user.is_authenticated and user == profile.user %}

      <br><br>
      <a href="{% url 'profile-edit'%}" class="btn">Edit Profile</a>

      {% endif %}


      {% if user.is_authenticated  and user != profile.user %}
        <br><br>
        {% if user in profile.followers.all %}
        <a href="{% url 'follow' profile.user.username %}" class="btn">Unfollow</a>
        {% else %}
        <a href="{% url 'follow' profile.user.username %}" class="btn">Follow</a>
        {% endif %}
      {% endif %}


    </section>
    <section id="grid-container">
      <a href="{%url 'user-star-movies' profile.user.username%}">
      <div class="grid-item" >
        <i class="material-icons" aria-hidden="true">local_movies</i> Movies
        <div class="amount">{{movies_star_count}}</div>
      </div>
      </a>
      <a href="{%url 'user-star-series' profile.user.username%}">
      <div class="grid-item" >
        <i class="material-icons" aria-hidden="true">ondemand_video</i> Series
        <div class="amount">{{series_star_count}}</div>
      </div>
      </a>
      <a href="{%url 'user-watchlist' profile.user.username%}">
      <div class="grid-item" >
        <i class="material-icons" aria-hidden="true">playlist_add</i> Watchlist
        <div class="amount">{{watchlist_count}}</div>
      </div>
      </a>
      <a href="{%url 'user-watchedlist' profile.user.username%}">
      <div class="grid-item" >
        <i class="material-icons" aria-hidden="true">playlist_add_check</i> Watched
        <div class="amount">{{watchedlist_count}}</div>
      </div>
      </a>
      <a href="{%url 'user-reviews' profile.user.username%}">
      <div class="grid-item" >
        <i class="material-icons" aria-hidden="true">rate_review</i> Reviews
        <div class="amount">{{opinions_count}}</div>
      </div>
      </a>
    </section>


    {% if list_title %}
    {% if data %}
    <h4>{{list_title}}: </h4>
    <div class="divider"></div>

    <article id="content">
      <section id="movie-container">
    {% else %}
    {% if list_title == 'Watchlist' or list_title == 'Watchedlist' %}
    {% if user.is_authenticated and user == profile.user %}
    <h4>There is no movies or series in your {{list_title.lower}}</h4>
    {% else %}
    <h4>There is no movies or series in {{profile.user.username}}'s {{list_title.lower}}</h4>
    {% endif %}
    {% elif list_title == 'Reviewed' %}
    {% if user.is_authenticated and user == profile.user %}
    <h4>You have not {{list_title.lower}} any movie or series!</h4>
    {% else %}
    <h4>{{profile.user.username}} has not {{list_title.lower}} any movie or series!</h4>
    {% endif %}
    {% elif list_title == 'Favourite movies' or list_title == 'Favourite series' %}
    {% if user.is_authenticated and user == profile.user %}
    <h4>You have no {{list_title.lower}} </h4>
    {% else %}
    <h4>{{profile.user.username}} has no {{list_title.lower}} </h4>
    {% endif %}
    {% endif %}

    <article id="content">
      <section id="movie-container">
    {% endif %}

    

      {% if list_title == 'Reviewed' %}

      {%for o in data %}

        <div class="one-card">
          <a href="{% url 'user-rating' o.user.username o.movie.imdbID %}">
            <div class="card">
              <div class="card-image">
                <img src="{{o.movie.Poster.url}}">
              </div>
              <div class="card-content">
                <span class="card-title">{{o.movie.Title}}</span>
                <p>{{o.movie.Year}}</p>
                <p>{{o.movie.Type}}</p>
              </div>
              <a href="{% url 'movie-details' o.movie.imdbID%}">
                <div class="card-action">
                    Details
                </div>
              </a>
            </div>
          </a>
        </div>

        {% endfor %}

        {% elif list_title == 'Followers' or list_title == 'Following' %}

        {% if data %}
          <div class="main-result" style="top: 100px;width: 100vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div class="card" style="width: 80%;">
                  <div class="card-content">
                    <ul class="collection">

                      {% for u in data %}
                      <li class="collection-item avatar" style="margin: 50px 0;">
                          {% if u.profile.picture %}
                          <img src="{{ u.profile.picture.url }}" alt="" class="circle">
                          {% else %}
                          <img src="{% static 'img/woman.png' %}" alt="" class="circle">
                          {% endif %}
                          <span class="title" style="color: rgba(255,255,255,.6);">{{u.first_name}}&nbsp{{u.last_name}}</span>
                          <p class="username"><a href="{% url 'profile' u.username %}" style="color: #45C718;">@{{u.username}}</a></p>
                      </li>
                      {% endfor %}


                    </ul>
                  </div>
            </div>
          </div>
        {% else %}
          {% if list_title == 'Followers' %}
          {% if user.is_authenticated and user == profile.user %}
          <h4>You have no {{list_title.lower}}</h4>
          {% else %}
          <h4>{{profile.user.username}} has no {{list_title.lower}}</h4>
          {% endif %}
          {% else %}
          {% if user.is_authenticated and user == profile.user %}
          <h4>You are not {{list_title.lower}} anybody! Search for our users <a href="{% url 'search-users' %}" style="color: blue">here</a></h4>
          {% else %}
          <h4>{{profile.user.username}} is not {{list_title.lower}} anybody!</h4>
          {% endif %}
          {% endif %}
        {% endif %}

        {% else %}

        {%for m in data %}

        <div class="one-card">
          <a href="{% url 'movie-details' m.imdbID%}">
            <div class="card">
              <div class="card-image">
                <img src="{{m.Poster.url}}">
              </div>
              <div class="card-content">
                <span class="card-title">{{m.Title}}</span>
                <p>{{m.Year}}</p>
                <p>{{m.Type}}</p>
              </div>
              <a href="{% url 'movie-details' m.imdbID%}">
                <div class="card-action">
                    Details
                </div>
              </a>
            </div>
          </a>
        </div>

        {% endfor %}

        {% endif %}

        </section>

      <div class="load-more-container">

      {% if data.has_previous %}

        <a class="cta-btn" href="?page={{ data.previous_page_number }}">
          load less<i class="material-icons" aria-hidden="true" style="margin-left: 10px;">arrow_drop_up</i>
        </a>
      {% endif %}

      {% if data.has_next %}

        <a class="cta-btn" href="?page={{ data.next_page_number }}">
          load more<i class="material-icons" aria-hidden="true" style="margin-left: 10px;">arrow_drop_down</i>
        </a>
      {% endif %}
      </div>


    </article>

    {% endif %}
  </main>

{% endblock %}
